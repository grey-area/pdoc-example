stages:
  - build
  - deploy

build-docs:
  stage: build
  script:
    - docker build -t pdoc-image ./gitlab-ci-docs
    # Generate the documentation in a container
    - docker run --name pdoc-container pdoc-image
    # Copy the generated docs from the container to the host
    - docker cp pdoc-container:/usr/src/app/docs ./docs
  artifacts:
    paths:
      - docs/
  tags:
    - linux
    - docker
  interruptible: true
  # For tagged releases, use "- tags" instead
  only:
    - master

cache:
  paths:
    - venv/

pages:
  stage: deploy
  script:
    - mkdir -p public
    - mv docs/* public
  artifacts:
    paths:
      - public
  tags:
    - linux
  interruptible: true
  # For tagged releases, use "- tags" instead
  only:
    - master